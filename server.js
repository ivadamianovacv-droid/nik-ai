import express from "express";
import cors from "cors";

const app = express();
app.use(cors());
app.use(express.json());

// --- УМЕН ОФЛАЙН ЧАТБОТ ЗА КОМУНИЗЪМ ---

function smartAnswer(question) {
    const q = question.toLowerCase();

    // Основни дефиниции
    if (q.includes("какво е комунизъм") || q.includes("комунизъм е")) {
        return "Комунизмът е идеология, която цели създаване на безкласово общество, премахване на частната собственост и равенство между всички хора.";
    }

    if (q.includes("социализъм") && q.includes("разлика")) {
        return "Комунизмът е крайната цел — пълно равенство и обща собственост. Социализмът е преходен етап, в който държавата контролира производството.";
    }

    // България
    if (q.includes("комунизъм в българия") || q.includes("бкп")) {
        return "В България комунизмът започва през 1944 г. след преврата на 9 септември, когато БКП взема властта. Продължава до 1989 г.";
    }

    if (q.includes("тодор живков")) {
        return "Тодор Живков управлява България от 1954 до 1989 г. по време на комунизма. Управлението му е свързано с централизирана власт, пропаганда и зависимост от СССР.";
    }

    if (q.includes("кога") && q.includes("свършва")) {
        return "Комунизмът в България приключва на 10 ноември 1989 г. с падането на Тодор Живков.";
    }

    // Съветски съюз
    if (q.includes("кога") && q.includes("ссср")) {
        return "СССР е създаден през 1922 г. след Октомврийската революция, и се разпада през 1991 г.";
    }

    if (q.includes("ленин")) {
        return "Владимир Ленин е лидерът на болшевиките и основател на СССР. Той прилага първите комунистически реформи.";
    }

    if (q.includes("сталин")) {
        return "Сталин управлява СССР от 1924 до 1953 г. Управлението му е известно с индустриализация, репресии и ГУЛАГ.";
    }

    // Репресии
    if (q.includes("лагер") || q.includes("белене") || q.includes("репресии")) {
        return "По време на комунизма в България съществува лагерът Белене, използван за политически затворници и преследване на неудобни на властта хора.";
    }

    // Политика
    if (q.includes("идеология")) {
        return "Комунистическата идеология се основава на идеите на Маркс и Енгелс, които предвиждат премахване на частната собственост и класовите различия.";
    }

    // Въпроси извън темата
    if (
        !q.includes("комунизм") &&
        !q.includes("бкп") &&
        !q.includes("ссср") &&
        !q.includes("социализъм") &&
        !q.includes("тодор живков") &&
        !q.includes("сталин") &&
        !q.includes("белене") &&
        !q.includes("ленин")
    ) {
        return "Мога да отговарям само на въпроси за комунизма. Опитай да ме попиташ нещо свързано с историята на комунизма!";
    }

    return "Не намерих точен отговор, но мога да отговарям само по теми, свързани с комунизма. Попитай ме по-конкретно!";
}

// --- API маршрут ---
app.post("/ask", (req, res) => {
    const question = req.body.question || "";
    const answer = smartAnswer(question);
    res.json({ answer });
});

// --- Старт ---
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log("Server running on port " + PORT));
